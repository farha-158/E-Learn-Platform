<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Course Details</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">

  <div class="container mt-5">
    <div id="courseContainer" class="card shadow p-4">
      <h2 id="courseName">Loading...</h2>
      <img id="courseImage" class="img-fluid mb-4" style="max-height:300px; object-fit: contain;" />
      <p id="courseDesc"></p>
      <p><strong>Duration:</strong> <span id="courseDuration"></span> Hour</p>
      <p><strong>Level:</strong> <span id="courseLevel"></span></p>
      <p><strong>Language:</strong> <span id="courseLanguage"></span></p>
      <p><a href="/instuctur/:Iid/:Uid" style="color: black;" id="instructorURL"><strong>Instructor Name:</strong></a> <span id="courseInstructor"></span></p>
      <h3 class="text-primary mt-3">Price: $<span id="coursePrice"></span></h3>
      <p><strong>Release Date:</strong> <span id="courseRelease"></span></p>
      <p><strong>Video Count:</strong> <span id="courseVideos"></span></p>
      <button id="enrollBtn" class="btn btn-success mt-3">Enroll Now</button>
    </div>
  </div>

  <script>
    async function loadCourse() {
      try {
        const res = await fetch(`/api/<%= Cid %>`); 
        const json = await res.json();
        const course = json.data;
        const res1 = await fetch(`/instructor/api/${course.instructor}`);  
        const json1 = await res1.json();
        const instr = json1.data;
        console.log(instr)
        userId="<%= Uid %>"
        const instructorEl = document.getElementById("instructorURL");
        instructorEl.href = `/instructor/${instr._id}/${userId}`;

        // عرض البيانات في الصفحة
        document.getElementById("courseName").innerText = course.name;
        document.getElementById("courseImage").src = "/" + course.thumbnailImage.replace(/\\/g, '/');
        document.getElementById("courseDesc").innerText = course.description;
        document.getElementById("courseDuration").innerText = course.courseDuration;
        document.getElementById("courseLevel").innerText = course.level;
        document.getElementById("courseLanguage").innerText = course.language;
        document.getElementById("courseInstructor").innerText = instr.name;
        document.getElementById("coursePrice").innerText = course.price;
        document.getElementById("courseRelease").innerText = new Date(course.releaseDate).toLocaleDateString();
        document.getElementById("courseVideos").innerText = course.videoCount;

      } catch (err) {
        console.error("Error loading course:", err);
        document.getElementById("courseContainer").innerHTML = "<p class='text-danger'>Failed to load course data.</p>";
      }
    }

    loadCourse();
  </script>

</body>
</html>
